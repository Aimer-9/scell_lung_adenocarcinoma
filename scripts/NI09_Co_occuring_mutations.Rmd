---
title: "R Notebook"
output: html_notebook
---

Read in data
```{r}
# rm(list=ls())
dir <- "/myVolume/scell_lung_adenocarcinoma/"
sum_tab <- read.csv(file = paste(dir, "data_out/NI06/NI06_mutation_summary_table.csv", sep = ""))
mut_of_int <- read.csv(file = paste(dir, "gene_lists/mutations_of_interest.csv", sep = ""))
mut_of_int
```

Subset genes and sample names
```{r}
clinical.mut <- as.character(mut_of_int$Gene_Symbol[grep("Clinically", mut_of_int$Gene_Source)])
tier.mut <- as.character(mut_of_int$Gene_Symbol[grep("Tier", mut_of_int$Gene_Source)])
samples <- as.character(sum_tab[,1]) # If sample ID is not the first column than this wont work.. )
```


Create tables to summarize data 
This will be a binary table for clinical mutations
```{r}
mat.clinical <- as.data.frame(matrix(nrow=length(samples), ncol=length(clinical.mut)))
row.names(mat.clinical) <- samples
colnames(mat.clinical) <-   clinical.mut
mat.clinical
```

This will be a table for the number of other Tier 1 mutations summarized by gene
```{r}
mat.tier <- as.data.frame(matrix(nrow=length(samples), ncol=length(tier.mut)))
row.names(mat.tier) <- samples
colnames(mat.tier) <-   tier.mut 
mat.tier
```


Loop over each sample and populate each table 

First the clinical mutations 
```{r}
for(i in 1:length(samples)){
  # Separate text in mutations column 
  muts <- as.character(sum_tab[i,"mutations"])
  muts <- unlist(strsplit(muts, "/"))
  # Remove leading/trailing whitespace
  muts <- trimws(muts, "both")
  # Count clinical mutations for every gene in the clinical.mut vector
  for(j in 1:length(clinical.mut)){
    a <- muts %in% clinical.mut[j]
    if (length(which(a==T))!=0) {mat.clinical[i,j] <- 1} else {mat.clinical[i,j] <- 0}
  }
}
mat.clinical
```

Second, count the tier1 COSMIC mutations for each gene in tier.mut
```{r}
for(i in 1:length(samples)){
  # Separate text in mutations column 
  muts <- as.character(sum_tab[i,"mutations"])
  muts <- unlist(strsplit(muts, "/"))
  # Remove leading/trailing whitespace
  muts <- trimws(muts, "both")
  # Count non-synonymous mutations for every gene in the tier.mut vector
  for(j in 1:length(tier.mut)){
    # Subset gene name 
    gene <- tier.mut[j]
    # Split mutations to gene and mutation 
    muts.t <- do.call(rbind,strsplit(muts, " "))
    # Find all occurences of that gene in the mutations of that sample 
    submuts <- muts[which(muts.t[,1]==gene)]
    # submuts <- muts[grep(gene, muts)]
    # Make sure they are all unique
    submuts <- unique(submuts)
    # Remove mutations that are in the clinical category 
    submuts <- submuts[which((submuts %in% clinical.mut)==F)]
    # Remove any text befoer the space 
    submuts <- sub(".*? (.+)", "\\1", submuts)
    # Remove synonymous mutations 
    # Get first and last character (which should be the aminoacid)
    first <- substring(submuts,1,1)
    last <- substring(submuts,nchar(submuts),nchar(submuts))
    # Compare the two vectors and select the ones that are FALSE. TRUE are synonymous
    non.syn.submuts <- submuts[which((first == last)==F)]
    # Count non-synonymous
     mat.tier[i,j] <- length(non.syn.submuts)
    }
}
```

Plot the Heatmaps for Clinically Reported Genes
```{r}
# Binarize to plot and check 
mat.clinical.b <- mat.clinical
mat.clinical.b[mat.clinical.b !=0] <- 1
# filter the rows that have a column sum of zero
mat.clinical.b.f <- mat.clinical.b
mat.clinical.b.f$sample <- rownames(mat.clinical.b.f)
mat.clinical.b.f <- mat.clinical.b.f[,colSums(mat.clinical.b.f[,1:7]) > 0]
# set up data for heatmap
heat.mat.clinical <- mat.clinical.b.f
heat.mat.clinical.m <- melt(heat.mat.clinical)
# plot
ggplot(heat.mat.clinical.m, aes(sample, variable)) +
    geom_tile(aes(fill = value),colour = "black") + 
    scale_fill_gradient(low = "white", high = "black") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Plot the Heatmaps for Cosmic Tier 1 Genes
```{r}
# Binarize to plot and check 
mat.tier.b <- mat.tier
mat.tier.b[mat.tier.b !=0] <- 1
# filter the rows that have a col sum of zero
mat.teir.b.f <- mat.tier.b
mat.teir.b.f$sample <- rownames(mat.teir.b.f)
mat.teir.b.f <- mat.teir.b.f[,colSums(mat.teir.b.f[,1:41]) > 0]
# set up data for heatmap
heat.mat.tier <- mat.teir.b.f
heat.mat.tier.m <- melt(heat.mat.tier)
# plot
ggplot(heat.mat.tier.m, aes(sample, variable)) +
    geom_tile(aes(fill = value),colour = "black") + 
    scale_fill_gradient(low = "white", high = "black") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Map clincal and tier one mutations together
```{r}
mat.clinical.b.f$sample <- NULL
mat.teir.b.f$sample <- NULL
all.mat <- cbind(mat.clinical.b.f, mat.teir.b.f)
# filter out any patients without mutations
all.mat.f <- all.mat[rowSums(all.mat) > 0, ]
# set up data for heatmap
heat.all.mat <- all.mat.f
heat.all.mat$sample <- rownames(heat.all.mat)
heat.all.mat.m <- melt(heat.all.mat)
# plot
pdf(file = paste(dir, "plot_out/NI09/NI09_comutation_summary_heatmap.pdf", sep = ""))
ggplot(heat.all.mat.m, aes(sample, variable)) +
    geom_tile(aes(fill = value),colour = "black") + 
    scale_fill_gradient(low = "white", high = "black") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
dev.off()
```



tiss_subset@meta.data
View(tiss_subset@meta.data)
unique(tiss_subset@meta.data$general_annotation)
library(Seurat)
#load("/Users/lincoln.harris/Desktop/04_tiss_subset_181016.RData")
load("../rawdata/04_tiss_subset_181016_ALL.RData")
dim(tiss_subset@meta.data)
colnames(tiss_subset@meta.data)
# A/B summary
tracer_summary <- read.csv("../TCR_analysis/filtered_TCRAB_summary/cell_data.csv", header = T)
meta_edit <- tiss_subset@meta.data
meta_edit$A_productive <- NA
meta_edit$A_productive <- as.vector(meta_edit$A_productive)
meta_edit$B_productive <- NA
meta_edit$B_productive <- as.vector(meta_edit$B_productive)
meta_edit$clonal_group_AB <- NA
meta_edit$group_size_AB <- NA
tracer_summary$cell_name <- gsub("[.]", "_", tracer_summary$cell_name)
match_vec <- match(row.names(meta_edit), tracer_summary$cell_name) # meta_edit first
match_vec1 <- match(tracer_summary$cell_name, row.names(meta_edit)) # tracer_summary first
length(match_vec)
length(match_vec1)
head(match_vec)
length(unique(match_vec))
for (i in 1:length(match_vec)){
currIndex <- match_vec[i]
meta_edit$A_productive[i] <- as.vector(tracer_summary$A_productive[currIndex])
meta_edit$B_productive[i] <- as.vector(tracer_summary$B_productive[currIndex])
}
write.csv(meta_edit, "metadata_with_assembled_TCRs.csv")
TSNEPlot(tiss_subset)
unique(tiss_subset@meta.data$epithelial_subannotation)
knitr::opts_chunk$set(echo = TRUE)
plot(pressure)
which(tiss_subset@meta.data$epithelial_subannotation != NA)
which(tiss_subset@meta.data$epithelial_subannotation == 1)
which(isna(tiss_subset@meta.data$epithelial_subannotation))
which(isNA(tiss_subset@meta.data$epithelial_subannotation))
?isNA
?is.na
which(is.na(tiss_subset@meta.data$epithelial_subannotation))
which(!(is.na(tiss_subset@meta.data$epithelial_subannotation)))
getwd()
setwd("/Users/lincoln.harris/code/sclung_adeno/TCR_analysis/")
tiss_subset_subset <- tiss_subset[toKeep,]
toKeep <- which(!(is.na(tiss_subset@meta.data$epithelial_subannotation)))
tiss_subset_subset <- tiss_subset[toKeep,]
tiss_subset_subset <- tiss_subset@meta.data[toKeep,]
View(tiss_subset_subset)
toKeep <- which(!(is.na(tiss_subset@meta.data$epithelial_subannotation)))
meta_edit <- tiss_subset@meta.data[toKeep,]
# A/B summary
tracer_summary <- read.csv("../TCR_analysis/filtered_TCRAB_summary/cell_data.csv", header = T)
meta_edit$A_productive <- NA
meta_edit$A_productive <- as.vector(meta_edit$A_productive)
meta_edit$B_productive <- NA
meta_edit$B_productive <- as.vector(meta_edit$B_productive)
meta_edit$clonal_group_AB <- NA
meta_edit$group_size_AB <- NA
tracer_summary$cell_name <- gsub("[.]", "_", tracer_summary$cell_name)
match_vec <- match(row.names(meta_edit), tracer_summary$cell_name) # meta_edit first
match_vec1 <- match(tracer_summary$cell_name, row.names(meta_edit)) # tracer_summary first
length(match_vec)
length(match_vec1)
head(match_vec)
for (i in 1:length(match_vec)){
currIndex <- match_vec[i]
meta_edit$A_productive[i] <- as.vector(tracer_summary$A_productive[currIndex])
meta_edit$B_productive[i] <- as.vector(tracer_summary$B_productive[currIndex])
}
View(meta_edit)
unique(tiss_subset@meta.data$general_annotation)
tiss_subset@meta.data <- meta_edit
View(meta_edit)
View(tiss_subset@meta.data)
cDNA_plate_metadata <- read.csv("../rawdata/cDNA_plate_metadata.csv", header = T)
tcr_summary_df <- read.csv("../TCR_analysis/filtered_TCRAB_summary/TCR_summary.txt", header = F)
View(tcr_summary_df)
tcr_summary_df <- read.csv("../TCR_analysis/filtered_TCRAB_summary/TCR_summary1.txt.txt", header = F)
tcr_summary_df <- read.csv("../TCR_analysis/filtered_TCRAB_summary/TCR_summary1.txt", header = F)
View(tcr_summary_df)
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
print(length(unique(patientsList)))
}
}
print(len, i)
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
print(currLen, i)
#print(length(unique(patientsList)))
}
}
print('clonalGroup', '     ', 'numPatients')
#print('clonalGroup', '     ', 'numPatients')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
print(currLen, i)
#print(length(unique(patientsList)))
sprintf('%d     %d', clonalGroupNum, currLen)
#url = sprintf("https:.../KBOS/%s/%s/%s/DailyHistory.html", year, mnth, day)
}
}
install.packages(glue)
install.packages('glue')
install.packages('glue')
install.packages("glue")
print(toPrint)
library(glue)
#library(glue)
#print('clonalGroup', '     ', 'numPatients')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
toPrint <- glue('{clonalGroupNum currLen}')
print(toPrint)
}
}
library(glue)
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
print(clonalGroupNum)
}
}
matches_df <- data.frame(matrix(ncol = 2, nrow = 0))
colnames(matches_df) <- c('Clonal_group', 'Num_patients')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
matches_df <- data.frame(matrix(ncol = 2, nrow = 1))
colnames(matches_df) <- c('Clonal_group', 'Num_patients')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
matches_df
matches_df <- matches_df[-1,]
matches_df
```{r, comment=NA}
matches_df <- matches_df[-1,]
matches_df
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
matches_df <- data.frame(matrix(ncol = 2, nrow = 1))
colnames(matches_df) <- c('Clonal_group', 'Num_patients')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
matches_df <- matches_df[-1,]
matches_df
matches_df$Group_size <- NA
matches_df <- data.frame(matrix(ncol = 3, nrow = 1))
colnames(matches_df) <- c('Clonal_group', 'Num_patients', 'Group_size')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(curr_clonogroup)
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(curr_clonogroup)
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
print(group_size)
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(curr_clonogroup)
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
print(length(curr_clonogroup))
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
View(tcr_summary_df)
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(!(is.na(curr_clonogroup)))
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
tcr_summary_df[10,]
tcr_summary_df[8,]
length(tcr_summary_df[8,])
is.na(tcr_summary_df[8,])
is.empty(tcr_summary_df[8,])
is.null(tcr_summary_df[8,])
is.null(tcr_summary_df[8,10])
is.null(tcr_summary_df[8,1])
is.empty(tcr_summary_df[8,1])
tcr_summary_df <- read.csv("../TCR_analysis/filtered_TCRAB_summary/TCR_summary1.txt", header = F, na.strings = NA)
tcr_summary_df <- read.csv("../TCR_analysis/filtered_TCRAB_summary/TCR_summary1.txt", header = F, na.strings = c("", NA))
is.na(tcr_summary_df[8,10])
is.na(tcr_summary_df[8,])
length(is.na(tcr_summary_df[8,]))
length(!(is.na(tcr_summary_df[8,])))
which(!(is.na(tcr_summary_df[8,])))
length(which(!(is.na(tcr_summary_df[8,]))))
matches_df <- data.frame(matrix(ncol = 3, nrow = 1))
colnames(matches_df) <- c('Clonal_group', 'Num_patients', 'Group_size')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(which(!(is.na(tcr_summary_df[8,]))))
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(which(!(is.na(tcr_summary_df[i,]))))
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(which(!(is.na(tcr_summary_df[i,]))))
print(group_size)
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df <- data.frame(matrix(ncol = 3, nrow = 1))
colnames(matches_df) <- c('Clonal_group', 'Num_patients', 'Group_size')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(which(!(is.na(tcr_summary_df[i,]))))
print(group_size)
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
matches_df <- matches_df[-1,]
matches_df
matches_df <- data.frame(matrix(ncol = 3, nrow = 1))
colnames(matches_df) <- c('Clonal_group', 'Num_patients', 'Group_size')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(which(!(is.na(tcr_summary_df[i,]))))
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
matches_df <- matches_df[-1,]
matches_df
print(matches_df, row.names = F)
matches_df <- matches_df[-1,]
print(matches_df, row.names = F)
cDNA_plate_metadata <- read.csv("../rawdata/cDNA_plate_metadata.csv", header = T)
tcr_summary_df <- read.csv("../TCR_analysis/filtered_TCRAB_summary/TCR_summary1.txt", header = F, na.strings = c("", NA))
matches_df <- data.frame(matrix(ncol = 3, nrow = 1))
colnames(matches_df) <- c('Clonal_group', 'Num_patients', 'Group_size')
for(i in 1:nrow(tcr_summary_df)){
curr_clonogroup <- tcr_summary_df[i,]
group_size <- length(which(!(is.na(tcr_summary_df[i,]))))
patientsList <- c()
for(j in 1:length(curr_clonogroup)){
curr_cell <- tcr_summary_df[i,j]
curr_cell <- as.character(curr_cell)
curr_plate <- strsplit(curr_cell, "_")[[1]][2]
curr_index <- which(cDNA_plate_metadata$plate == curr_plate)
curr_patient <- cDNA_plate_metadata$patient_id[curr_index]
patientsList <- c(patientsList, curr_patient)
}
if(length(unique(patientsList)) > 1){
currLen <- length(unique(patientsList))
clonalGroupNum <- i
rowToAdd <- c(clonalGroupNum, currLen, group_size)
matches_df <- rbind(matches_df, rowToAdd)
}
}
matches_df
matches_df1 <- matches_df[-1,]
print(matches_df1, row.names = F)
